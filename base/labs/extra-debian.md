# Факультатив <!-- omit in toc -->
# Установка Debian на виртуальную машину UTM или VirtualBox <!-- omit in toc -->

- [1 Создание виртуальной машины](#1-создание-виртуальной-машины)
  - [1.1 Создание виртуальной машины UTM (MacOS)](#11-создание-виртуальной-машины-utm-macos)
  - [1.2 Создание виртуальной машины VirtualBox (Windows)](#12-создание-виртуальной-машины-virtualbox-windows)
- [2 Установка операционной системы](#2-установка-операционной-системы)
- [3 Некоторые базовые действия при работе с Debian](#3-некоторые-базовые-действия-при-работе-с-debian)
  - [3.1 Эмулятор терминала](#31-эмулятор-терминала)
  - [3.2 `sudo`](#32-sudo)
  - [3.3 Установка пакетов](#33-установка-пакетов)

# 1 Создание виртуальной машины

## 1.1 Создание виртуальной машины UTM (MacOS)

1. Скачайте установочный ISO-образ для операционной системы (ОС) Debian.
   - Откройте страницу загрузки [Debian](https://www.debian.org/distrib/netinst).
   - В секции `Small CDs or USB sticks` скачайте образ для архитектуры:
     - `amd64`, если у вас MacOS на архитектуре x64 (Intel);
     - `arm64`, если у вас MacOS на архитектуре ARM (Apple M1 или новее).
1. Скачайте и установите [UTM](https://mac.getutm.app/).
   - UTM официально доступен как для бесплатного скачивания в виде `dmg`-файла,
     так и для покупки и установки через App Store.
     Платная версия нужна для поддержки разработчиков и возможности получения автоматических обновлений.
     Помимо возможности автоматического обновления разницы между бесплатной и платной версией нет.
1. Запустите UTM.
1. Создайте новую виртуальную машину (ВМ): `Create a New Virtual Machine`.
   - В окне `Start` выберите опцию `Virtualize`.
   - В окне `Operation System` выберите опцию `Linux`.
   - В окне `Linux` в секции `Boot ISO Image` укажите путь к скачанному установочному ISO-образу с Debian.
   - В окне `Hardware` укажите параметры ВМ.
     - Рекомендуемый минимум оперативной памяти (`Memory`): 2 ГБ (можно больше).
     - Количество ядер (`CPU Cores`) можно оставить пустым (по умолчанию) или явно указать 2 (можно больше).
   - В окне `Storage` укажите размер виртуального жёсткого диска.
     - Рекомендуемый минимум: 20 ГБ (можно больше).
   - В окне `Shared Storage` всё оставьте без изменений.
   - В окне `Summary` ознакомьтесь с итоговой конфигурацией ВМ и нажмите на `Save`.
     - В качестве названия ВМ вместо `Linux` можно указать более содержательное `Debian`.
1. В списке должна появиться новая ВМ. Дважды кликните по ней для её запуска.
   

## 1.2 Создание виртуальной машины VirtualBox (Windows)

1. Скачайте установочный ISO-образ для операционной системы (ОС) Debian.
   - Откройте страницу загрузки [Debian](https://www.debian.org/distrib/netinst).
   - В секции `Small CDs or USB sticks` скачайте образ для архитектуры `amd64`.
1. Скачайте и установите [VirtualBox](https://www.virtualbox.org/).
1. Запустите VirtualBox.
1. Создайте новую виртуальную машину (ВМ): `Machine` → `New...`.
   - Если вы находитесь в пошаговом режиме создания ВМ, то в нижней части окна будет доступна кнопка `Expert Mode`.
     Нажмите на неё для перехода в режим одного окна (когда все настройки ВМ указываются сразу в одном окне).
   - В секции `Name and Operating System` укажите параметры устанавливаемой ОС.
     - `Name` - укажите название ВМ (например, `Debian`).
     - `ISO Image` - укажите путь к скачанному установочному ISO-образу с Debian.
     - `Type` - выберите `Linux`.
     - `Version` - выберите `Debian 64-bit`.
     - Поставьте флажок `Skip Unattended Install` для большего контроля над процессом установки ОС.
   - В секции `Hardware` укажите параметры ВМ.
     - Рекомендуемый минимум оперативной памяти (`Base Memory`): 2 ГБ (можно больше).
     - Рекомендуемый минимум количества ядер (`Processors`): 2 (можно больше).
     - Поставьте флажок `Enable EFI (special OSes only)`.
   - В секции `Hard Disk`:
     - Выберите опцию `Create a Virtual Hard Disk Now`.
     - Укажите размер виртуального жёсткого диска.
       - Рекомендуемый минимум: 20 ГБ (можно больше).
     - У остальных параметров оставьте значения по умолчанию.
   - Нажмите кнопку `Finish` для создания ВМ с указанными параметрами.
1. В списке должна появиться новая ВМ. Дважды кликните по ней для её запуска.



# 2 Установка операционной системы

1. Запустите ВМ (см. первый раздел).
1. Дождитесь появления установочного меню Debian/GRUB и выберите `Install`.
1. В окне `Select a language` выберите `English`.
1. В окне `Select your location` выберите `Other` → `Europe` → `Russian Federation`.
1. В окне `Configure locales` выберите `United States` / `en_US.UTF-8`.
1. В окне `Configure the keyboard`:
   - `Keymap to use` - выберите `Russian`.
   - `Method for toggling between national and Latin mode` - выберите привычный вам способ переключения раскладок.
1. В окне `Configure the network`:
   - `Hostname` - укажите название машины (можно оставить `debian`).
   - `Domain name` - оставьте пустым.
1. В окне `Set up users and passwords`:
   - `Root password` - задайте пароль суперпользователя (администратора) системы.
     - Здесь и везде далее при вводе пароля рекомендуется ставить флажок `Show Password in Clear`,
       чтобы убедиться, что вы вводите пароль в правильной раскладке.
   - `Re-enter password to verify` - продублируйте пароль суперпользователя для подтверждения.
   - `Full name for the new user` - укажите полное имя обычного пользователя системы (например `Sergey Ivanov`).
   - `Username for your account` - укажите логин обычного пользователя (в нижнем регистре, например `sergey`).
   - `Choose a password for the new user` - задайте пароль обычного пользователя.
   - `Re-enter password to verify` - продублируйте пароль обычного пользователя для подтверждения.
1. В окне `Configure the clock` выберите часовой пояс `Moscow+01 - Samara`.
1. В окне `Partition disks`:
    - `Partitioning method` - выберите `Guided - use entire disk`.
    - `Select disk to partition` - выберите диск для разметки (у вас должен быть только один виртуальный диск с размером
      *примерно* равным тому, который вы указывали при создании ВМ).
    - `Partitioning scheme` - выберите `All files in one partition`.
    - В финальном окне выберите `Finish partitioning and write changes to disk`.
    - `Write the changes to disks?` - подтвердите форматирование виртуального диска, выбрав `Yes`.
1. Дождитесь установки базовой системы.
1. В окне `Configure the package manager`:
   - `Scan extra installation media?` - выберите `No`.
   - `Debian archive mirror country` - выберите `Russian Federation`.
   - `Debian archive mirror` - выберите `deb.debian.org`.
   - `HTTP proxy information` - оставьте пустым.
1. Дождитесь установки базового программного обеспечения.
1. На вопрос `Participate in the package usage survey?` ответьте `No`.
1. В окне `Software selection` установите флажки только на следующие компоненты:
   - `Debian desktop environment`
   - `KDE Plasma`
   - `Standard system utilities`
1. Дождитесь установки выбранных компонентов.
1. В окне `Finish the installation` убедитесь, что диск с образом ОС извлечён из виртуального дисковода
   и только потом нажмите на `Continue`, чтобы перезагрузиться в свежеустановленную систему.
   - `UTM`. В правом верхнем углу ВМ нажмите на кнопку со всплыпающей подсказкой `Drive image options`.
     Далее наведите курсор на вставленный ISO-образ и выберите `Eject`.
   - `VirtualBox`. В меню ВМ нажать (если она доступна) на кнопку `Devices` → `Optical Drives` → `Remove disk from virtual drive`.



# 3 Некоторые базовые действия при работе с Debian

## 3.1 Эмулятор терминала

Запустите ВМ и войдите в ОС. Вы должны увидеть рабочий стол.

Под Linux доступно множество эмуляторов терминала, которые можно использовать в графической сессии.
Графическое окружение `KDE Plasma` поставляется с предустановленным эмулятором терминала `Konsole`.
Запустите `Konsole` для доступа к командной строке.

## 3.2 `sudo`

Установка новых пакетов требует права суперпользователя.
Выполнять команды с правами суперпользователя в сессии обычного пользователя можно с помощью [sudo](https://wiki.debian.org/sudo).

Чтобы дать возможность пользователю использовать `sudo`, выполните следующие действия в командной строке:
1. Введите команду `su -` и введите пароль суперпользователя.
   Данная команда инициализируют сессию суперпользователя
   (все дальнейшие команды в рамках сессии будут выполняться от имени суперпользователя).
1. Введите команду `adduser sergey sudo` для добавления пользователя `sergey`
   (замените на логин вашего пользователя) в группу `sudo`.
1. Для применения изменений компьютер необходимо перезагрузить.
   Введите команду `reboot` для перезагрузки компьютера (ВМ).
   Или сделайте это через графический интерфейс.

После перезагрузки вы должны иметь возможность выполнять любую команду от имени суперпользователя, предварив её `sudo`.

Проверьте работоспособность `sudo` на примере `whoami` в командной строке:
1. Введите команду `whoami`. `whoami` должна вывести имя текущего пользователя (например, `sergey`).
1. Введите команду `sudo whoami`.
   Программа (`sudo`) попросит ввести пароль обычого пользователя (не суперпользователя!)
   и после этого выполнит `whoami` от имени суперпользователя.
   В этом случае `whoami` должна вывести имя суперпользователя (`root`).

## 3.3 Установка пакетов

В Debian управление пакетами может осуществляться с помощью [apt](https://www.debian.org/doc/manuals/debian-faq/pkgtools.html#apt-get).

Установка нового пакета состоит из двух шагов.

1. Обновление метаданных (доступных версий пакетов) с помощью команды `apt update`.
1. Непосредственная установка пакета с помощью `apt install`.
   Например, для установки пакета `cmake` нужно ввести команду `apt install cmake`.
   В команде `apt install ...` вместо `...` можно указать произвольное количество пакетов для установки
   (имена пакетов отделяются друг от друга пробелом).

Попробуйте установить какой-нибудь пакет, например, `cmake`:
```
sudo apt update
sudo apt install cmake
```

Проверьте, что `cmake` успешно установился: например, вызовите справку (`cmake --help`)
или запросите установленную версию (`cmake --version`).
