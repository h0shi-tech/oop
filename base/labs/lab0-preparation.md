# Подготовка к выполнению лабораторных работ <!-- omit in toc -->

- [1 Установка необходимых программ](#1-установка-необходимых-программ)
  - [1.1 Linux](#11-linux)
  - [1.2 MacOS](#12-macos)
  - [1.3 Windows](#13-windows)
- [2 Основы работы в командной строке](#2-основы-работы-в-командной-строке)
  - [2.1 Приглашение командной строки](#21-приглашение-командной-строки)
  - [2.2 Запуск приложений и аргументы командной строки](#22-запуск-приложений-и-аргументы-командной-строки)
  - [2.3 Смена текущей директории](#23-смена-текущей-директории)
- [3 Сборка проекта вручную](#3-сборка-проекта-вручную)
  - [3.1 Подготовка файла с исходным кодом](#31-подготовка-файла-с-исходным-кодом)
  - [3.2 Linux](#32-linux)
  - [3.3 MacOS](#33-macos)
  - [3.4 Windows](#34-windows)
- [4 Сборка проекта с помощью CMake](#4-сборка-проекта-с-помощью-cmake)
  - [4.1 CMake и файл `CMakeLists.txt`](#41-cmake-и-файл-cmakeliststxt)
  - [4.2 Использование CMake напрямую](#42-использование-cmake-напрямую)
  - [4.3 Использование CMake в средах разработки](#43-использование-cmake-в-средах-разработки)
    - [4.3.1 Linux](#431-linux)
      - [Среда разработки Qt Creator (рекомендуемый вариант)](#среда-разработки-qt-creator-рекомендуемый-вариант)
      - [Текстовый редактор Visual Studio Code с расширениями](#текстовый-редактор-visual-studio-code-с-расширениями)
    - [4.3.2 MacOS](#432-macos)
      - [Текстовый редактор Visual Studio Code с расширениями (рекомендуемый вариант)](#текстовый-редактор-visual-studio-code-с-расширениями-рекомендуемый-вариант)
      - [Среда разработки Xcode](#среда-разработки-xcode)
    - [4.3.3 Windows](#433-windows)

# 1 Установка необходимых программ

## 1.1 Linux

С помощью пакетного менеджера своего дистрибутива установите следующие пакеты:
- инструменты разработчика (называются `build-essential` на дистрибутивах Debian/Ubuntu);
- `cmake`;
- `git`;
- `nano` или `vim` для редактирования текстовых файлов в CLI-режиме;
- [любой](https://www.tecmint.com/best-open-source-linux-text-editors/) текстовый редактор по своему выбору
  для редактирования текстовых файлов в GUI-режиме (например, `kate`).

Если у вас Debian, установленный по [этой](extra-debian.md) инструкции,
то `git`, `nano` и `kate` будут предустановлены, а `cmake` вы уже установили сами.
Остаётся лишь установить недостающие инструменты разработчика:
```
sudo apt install build-essential
```

## 1.2 MacOS

**CMake**

Скачайте и установите [CMake](https://cmake.org/download/).

**Finder**

Убедитесь, что у вас включено отображение расширений для всех типов файлов.

1. Запустите `Finder`.
1. Откройте меню `Finder` → `Settings`.
1. Перейдите на вкладку `Advanced`.
1. Поставьте флажок `Show all filename extensions`.

**Git**

Включён в поставку `Xcode`. Отдельная установка не нужна.

**Xcode**

Установите [Xcode](https://apps.apple.com/ru/app/xcode/id497799835) через `App Store`.
Сразу после установки запустите `Xcode` хотя бы один раз для принятия лицензионного соглашения.

**Текстовый редактор**

В CLI-режиме используйте `nano` или `vim`. Оба приложения включены в поставку MacOS, отдельная установка не нужна. Подробнее [здесь](https://support.apple.com/ru-ru/guide/terminal/apdb02f1133-25af-4c65-8976-159609f99817/mac).

В GUI-режиме рекомендуется использовать любой текстовый редактор на свой выбор с подсветкой синтаксиса.
Если всё-таки используете стандартный `TextEdit`, то убедитесь, что используете его в режиме `Plain Text`.



## 1.3 Windows

**Explorer**

Убедитесь, что у вас включено отображение стандартных расширений в названиях файлов и отображение скрытых файлов.
В меню перейдите на вкладку `View` и в секции `Show/hide` поставьте флажки `File name extensions` и `Hidden items`.

**Git**

Скачайте и установите [git](https://git-scm.com/downloads) (необязательно).

**Notepad++**

Скачайте и установите [Notepad++](https://notepad-plus-plus.org/downloads/).

Рекомендуется использовать `Notepad++` вместо стандартного `Notepad` во всех случаях.

**Visual Studio**

Скачайте и установите [Visual Studio Community](https://visualstudio.microsoft.com/downloads/).

Если `Visual Studio` уже установлена, запустите `Visual Studio Installer` и нажмите на кнопку `Modify` для редактирования существующей установки.

В окне выбора устанавливаемых компонентов:
1. На вкладе `Workloads` убедитесь, что стоит флажок на группе `Desktop development with C++`.
   Если флажок уже стоит, рекомендуется убрать его и поставить снова
   (на тот случай, если при первичной установке вы отключали какие-либо компоненты по умолчанию,
   которые, однако, могут потребоваться в текущем курсе).
1. На вкладке `Language packs` измените язык среды разработки на английский - поставьте флажок `English` и уберите флажок `Russian`.
1. Примените все сделанные изменения.

**Операционная система**

Убедитесь, что ваш пользователь назван англоязычно и одним словом (без пробелов),
даже если вы используете русскоязычную версию операционной системы
(впрочем, и тут рекомендуется переключиться на английскую версию).
Имена `Сергей` и `Сергей Иванов` не подходят категорически,
имен с пробелом (`Sergey Ivanov`) рекомендуется избегать,
имя `Sergey` подходит идеально.

Проверьте корректность существующего пользователя следующим образом.
Откройте свойства любого файла или любой директории на рабочем столе.
В окне свойств на вкладке `General` посмотрите на значение поля `Location` -
оно должно иметь вид `C:\Users\Sergey\Desktop`.
Проверьте, что у вас в пути вместо `Sergey` стоит подходящее англоязычное имя пользователя.

Если имя вашего пользователя не подходит, создайте нового пользователя с подходящим названием и далее работайте из под него.
Обратите внимание, что переименование существующего пользователя не поможет - дело в том,
что переименуется только отображаемое имя пользователя, но не реальная директория с данными пользователя.

Вы можете на свой страх и риск продолжать использовать русскоязычное имя пользователя, но, в таком случае, *пеняйте на себя*.



# 2 Основы работы в командной строке



## 2.1 Приглашение командной строки

Для работы в командной строке необходимо запустить:
- Linux: любой из эмуляторов терминала;
- MacOS: `Terminal`;
- Windows: `Command Prompt`.

При запуске командная строка выводит пользователю приглашение в формате
```
приглашение символ_разделитель
```
где после символа-разделителя ожидается ввод команды от пользователя.

Конкретный вид приглашения может выглядеть по-разному в зависимости от используемого терминала:
- Linux (в качестве символа-разделителя используется `$`; для суперпользователя вместо `$` будет `#`):
  ```
  sergey@debian:~$
  ```
- MacOS (в качестве символа-разделителя используется `%`):
  ```
  sergey@macos ~ %
  ```
- Windows (в качестве символа-разделителя используется `>`):
  ```
  C:\Users\Sergey>
  ```

Независимо от используемого терминала, приглашение содержит текущую директорию (рабочий каталог).
Обычно при запуске терминала текущей директорией становится домашняя директория пользователя.
Для пользователя с именем `sergey` домашняя директория располагается по следующему пути:
- Linux: `/home/sergey`;
- MacOS: `/Users/sergey`;
- Windows: `C:\Users\Sergey`.

На Linux и MacOS для краткого обозначения домашней директории используется специальной символ `~`,
который можно наблюдать в приведённых выше приглашениях командной строки.
Кроме того, на этих операционнных системах приглашение, помимо текущей директории,
содержит дополнительную информацию: имя пользователя (`sergey`) и имя текущей машины.



## 2.2 Запуск приложений и аргументы командной строки

После приглашения от пользователя ожидается ввод команды.
В качестве команды может выступать:
- встроенная команда терминала;
- произвольное приложение.

После названия команды могут указываться аргументы.
Список аргументов определяется запускаемым приложением.
Команда от аргументов и аргументы между собой разделяются пробелом.
Если название команды или аргумент содержит пробел, то такое название/аргумент заключается в двойные кавычки.
Ввод команды и аргументов завершается клавишей `Enter`.

При запуске приложения в качестве команды может указываться:
- полный путь к приложению;
- относительный путь к приложению (относительно текущей директории);
- только имя файла-приложения без пути, при условии, что приложение находится в текущей директории
  или одной из директорий, задаваемых переменной окружения `PATH`.

Рассмотрим различные примеры запуска приложений в Windows.
- Приложение стандартного блокнота `notepad.exe` находится в директории `C:\Windows\notepad.exe`.
  Так как директория `C:\Windows` включена в переменную окружения `PATH`,
  то для вызова приложения достаточно указать только имя приложения.
  Кроме того, на Windows разрешается опускать разрешение `.exe` из имени приложения.
  Таким образом, запуск блокнота можно осуществить любой из следующих команд:
  - `notepad`;
  - `notepad.exe`;
  - `C:\Windows\notepad`;
  - `C:\Windows\notepad.exe`.

  При запуске блокнота в качестве аргумента можно указать путь к файлу.
  В этом случае блокнот запустится не в режиме нового безымянного документа,
  а откроет для редактирования существующий файл.
  Например, если на рабочем столе пользователя `Sergey` есть файл `text.txt`,
  то для его открытия в блокноте можно ввести следующую команду:
  ```
  notepad C:\Users\Sergey\Desktop\text.txt
  ```

- Приложение браузера `firefox.exe` находится (при установке с параметрами по умолчанию)
  в директории `C:\Program Files\Mozilla Firefox`.
  Эта директория обычно не включена в переменную окружения `PATH`.
  Для вызова приложения придётся указать полный путь к приложению.
  Кроме того, так как путь содержит пробелы, его придётся взять в кавычки:
  ```
  "C:\Program Files\Mozilla Firefox\firefox.exe"
  ```
  При запуске браузера в качестве аргументов можно указать достаточно большое число опций.
  Для подробностей см., например, [Fixefox: Command Line Options](https://wiki.mozilla.org/Firefox/CommandLineOptions).



## 2.3 Смена текущей директории

Для смены текущей директории используется встроенная команда `cd`:
```
cd путь_к_новой_текущей_директории
```

Смена текущей директории позволяет сократить пути к запускаемым приложениям
и указываемые в аргументах пути к файлам за счёт использования относительных путей.

Так, на примере Windows:
- Если изначальная текущая директория - текущая директория пользователя (`C:\Users\Sergey`),
  то можно сменить текущую директорию на рабочий стол:
  ```
  cd Desktop
  ```
  Тогда открыть файл `text.txt` на рабочем столе можно с использованием относительного пути к файлу вместо полного:
  ```
  notepad text.txt
  ```
- Если сменить текущую директорию на директорию с приложением `firefox.exe` с помощью команды
  ```
  cd "C:\Program Files\Mozilla Firefox"
  ```
  то запустить приложение можно просто указав относительный путь к исполняемому файлу:
  ```
  firefox
  ```



# 3 Сборка проекта вручную

## 3.1 Подготовка файла с исходным кодом

Создайте в текстовом редакторе файл `lab1.cpp` с программой `Hello, world!`:

```cpp
#include <iostream>

int main() {
  std::cout << "Hello world!\n";
  return 0;
}
```

Содержательно данный код будет подробно описан в первой лабораторной работе.
На этапе подготовки к выполнению лабораторных работ нас интересует не столько код, как способы его сборки и запуска.

Для сборки и запуска программы достаточно лишь наличия файла с исходным кодом и установленного компилятора.
Далее показано, как можно собрать и запустить программу вручную в командной строке
без использования какой-либо среды разработки.



## 3.2 Linux

1. Запустите эмулятор терминала.
1. Перейдите в директорию с файлом исходного кода `lab1.cpp`.
1. Соберите исполняемый файл с помощью команды `g++ lab1.cpp -o lab1`.
   В случае успеха в директории рядом с файлом `lab1.cpp` должен появиться файл `lab1`.
   В случае неудачи компилятор выведет в терминал сообщения об ошибках.
1. Запустите собранный исполняемый файл с помощью команды `./lab1`.



## 3.3 MacOS

1. Запустите `Terminal`.
1. Перейдите в директорию с файлом исходного кода `lab1.cpp`.
1. Соберите исполняемый файл с помощью команды `clang++ lab1.cpp -o lab1`.
   В случае успеха в директории рядом с файлом `lab1.cpp` должен появиться файл `lab1`.
   В случае неудачи компилятор выведет в терминал сообщения об ошибках.
1. Запустите собранный исполняемый файл с помощью команды `./lab1`.



## 3.4 Windows

**Сборка**

1. Запустите командную строку разработчика `Developer Command Prompt for VS 2022`.
1. Перейдите в директорию с файлом исходного кода `lab1.cpp`.
1. Скомпилируйте файл с помощью команды `cl lab1.cpp /EHsc`.
   В случае успеха в директории рядом с файлом `lab1.cpp` должны появиться файлы `lab1.obj` и `lab1.exe`.
   В случае неудачи компилятор выведет в терминал сообщения об ошибках.

**Запуск**

1. Запустите командную строку `Command Prompt`.
1. Перейдите в директорию с исполняемым файлом `lab1.exe`.
1. Запустите файл командой `lab1`.

**Примечания**

1. Собрать файл можно и в обычной командной строке.
   Однако это потребует при вызове компилятора/линковщика указание дополнительных опций - в частности,
   местонахождение стандартных заголовочных файлов, скомпилированных файлов стандартной библиотеки и т. п.

1. Запустить файл можно и в командной строке разработчика.
   Однако, если вы поставляете готовый скомпилированный файл пользователям (клиентам),
   то командной строки разработчика в общем случае у них не будет
   (она доступна, только если установлена Visual Studio).
   В то время как обычная командная строка доступна в любой базовой установке Windows.



# 4 Сборка проекта с помощью CMake

## 4.1 CMake и файл `CMakeLists.txt`

В случае наличия в проекте большого количества исходных файлов ручная сборка проекта
с непосредственным использованием компилятора становится затруднительной.

Поэтому используются различные **системы сборки**.
Использование системы сборки подразумевает наличие дополнительного **файла сборки**,
содержащего в себе информацию о том, из каких файлов исходного кода и каким образом собирать проект.
К сожалению, для C++ нет единой кроссплатформенной системы сборки.
Так, например:
- в Linux обычно используется система сборки `make`, которая работает с компиляторами `g++`/`clang++`;
- в Windows обычно используется система сборки `msbuild` (Visual Studio), которая работает с компилятором `cl` (Visual Studio).

CMake - это кроссплатформенное средство автоматизации сборки, позволяющее абстрагироваться от конкретной системы сборки и компилятора.
Эта программа позволяет из файла сценария `CMakeLists.txt` сгенерировать файлы сборки под любую конкретную систему сборки.

Пусть в некоторой директории есть файл с исходным кодом `lab1.cpp`.
Простейший файл сценария `CMakeLists.txt`, располагающийся в той же директории и указывающий,
что этот файл необходимо собрать в исполняемое приложение, выглядит следующим образом:
```cmake
cmake_minimum_required(VERSION 3.0)
project(lab1 CXX)
add_executable(lab1 "lab1.cpp")
```

В первой строке указана минимальная версия CMake, требуемая для обработки данного файла `CMakeLists.txt`.

Во второй строке указано название проекта (`lab1`) и используемый язык программирования
(для C++ указывается `CXX`, для C указывается `C`).

Третья строка указывает, что необходимо собрать исполняемое приложение с названием `lab1` из исходного файла `lab1.cpp`.

Подробнее про CMake см. [официальный сайт](https://cmake.org/).



## 4.2 Использование CMake напрямую

Если файлы исходного кода снабжены сценарием сборки `CMakeLists.txt`,
то сборка проекта упрощается до следующих команд в терминале
независимо от используемой операционной системы и компилятора:
```
cmake . -B build
cmake --build build
```

Первая команда генерирует файл сборки для конкретной системы сборки.
- В качестве аргумента ожидается путь к директории, в которой лежит файл `CMakeLists.txt`.
  Символ `.` означает текущую директорию.
- Опция `-B` позволяет указать директорию, в которой будут расположены сгенерированные файлы сборки.
  Если указанной директории не существует, она будет создана.
  Если эту опцию не указать, будет использоваться текущая директория, что обычно нежелательно
  (приведёт к перемешиванию файлов исходного кода с промежуточными и итоговыми файлами сборки).
- При генерации файла сборки CMake будет стараться автоматом определить используемую систему сборки.
  В случае наличия нескольких систем сборки может потребоваться явно указать
  используемый генератор (файла сборки) с помощью опции `-G`.
  Список доступных генераторов можно посмотреть с помощью `cmake --help`.

Вторая команда непосредственно вызывает систему сборки для реальной сборки проекта.
- В качестве аргумента ожидается путь к директории, в которой находится файл сборки, сгенерированный на прошлом шаге.

Вторая команда абстрагирует от нас вызов конкретной системы сборки.
Тем не менее, при необходимости, можно использовать систему сборки напрямую.
Покажем примеры прямого использования систем сборки и запуска собранного файла на разных системах.
- Linux (система сборки `make`):
  ```
  cmake . -B build
  cd build
  make
  ./lab1
  ```
- MacOS
  - cистема сборки `xcode`:
    ```
    cmake . -G Xcode -B build
    cd build
    xcodebuild
    ./Debug/lab1
    ```
  - cистема сборки `make`:
    ```
    cmake . -G "Unix Makefiles" -B build
    cd build
    make
    ./lab1
    ```
- Windows (система сборки `msbuild`; вызов `msbuild` должен происходить в командной строке разработчика):
  ```
  cmake . -B build
  cd build
  msbuild lab1.vcxproj
  Debug\lab1
  ```



## 4.3 Использование CMake в средах разработки

В данном разделе описываются наиболее предпочтительные варианты работы с CMake при выполнении лабораторных работ.

Подготовьте структуру проекта заранее.
1. Создайте директорию, в которой будут располагаться файлы проекта.
1. Разместите в этой директории файл сценария `CMakeLists.txt` и файл с исходным кодом.
   - В файле с исходным кодом для начала лучше разместить максимально простой `Hello, world!` или вообще пустой `main`.
     После того, как структура проекта будет готова и проект успешно откроется, соберётся и запустится
     в нужной вам среде разработки, можно начать постепенно имплементировать нужный вам код.

### 4.3.1 Linux

#### Среда разработки Qt Creator (рекомендуемый вариант)

1. Установите Qt Creator.
   - Если вы используете дистрибутив Debian, установите пакет `qtcreator`.
1. Запустите Qt Creator.
1. Выберите пункт меню `File` → `Open File or Project...`
   и в появившемся диалоговом окне выберите подготовленный файл `CMakeLists.txt`.
1. В секции `Configure Project` нажмите на кнопку `Configure Project`.
1. Дождитесь завершения открытия проекта.
1. Попробуйте собрать и запустить проект, нажав на зелёный треугольник в нижней левой части окна.

Далее вы можете добавлять/редактировать/удалять файлы исходного кода и при необходимости редактировать файл сценария `CMakeLists.txt` прямо в среде разработки Qt Creator.



#### Текстовый редактор Visual Studio Code с расширениями

1. Установите Visual Studio Code.
   - Если вы используете дистрибутив Debian, следуйте инструкциям из секции
     [Visual Studio Code: Installing via apt](https://wiki.debian.org/VisualStudioCode#Installing_via_apt).
     Возможно, предварительно понадобится установить пакет `curl`.
1. Запустите Visual Studio Code.
1. Установите необходимые расширения.
   - Перейдите на страницу управлениями расширениями (вкладка `Extensions` на панели слева).
   - Найдите и установите следующие расширения:
     - `ms-vscode.cpptools`
     - `ms-vscode.cmake-tools`
1. Выберите пункт меню `File` → `Open Folder...`
   и в появившемся диалоговом окне выберите директорию, в которой содержится подготовленный файл `CMakeLists.txt`.
   - При необходимости подтвердите, что вы доверяете автору открываемых вами файлов -
     ведь это же вы сами, не так ли?!
1. Нажмите на треугольник сборки и запуска проекта (он находится в строке состояния внизу окна
   и имеет всплывающую подсказку `Launch the selected target in the terminal window`).
   - При первом запуске в верхней части окна появится окно выбора используемых инструментов сборки. Выберите `GCC`.
1. Если все сделано правильно, откроется вкладка с терминалом, в котором будет запущено собранное приложение.

Далее вы можете добавлять/редактировать/удалять файлы исходного кода и при необходимости редактировать файл сценария `CMakeLists.txt` прямо в текстовом редакторе Visual Studio Code.



### 4.3.2 MacOS

#### Текстовый редактор Visual Studio Code с расширениями (рекомендуемый вариант)

1. Скачайте и установите [Visual Studio Code](https://code.visualstudio.com/Download).
1. Дальнейшие действия по настройке и открытия проекта почти ничем не отличаются от Linux -
   см. соответствующий [подраздел](#текстовый-редактор-visual-studio-code-с-расширениями).
   - Единственное отличие заключается в выборе инструментов сборки при первом запуске проекта (шаг 5).
     На MacOS выберите `Clang`, а не `GCC`.



#### Среда разработки Xcode

К сожалению, Xcode не поддерживает CMake.
Поэтому рекомендуется использовать Visual Studio Code с расширениями.

Тем не менее, если вы хотите использовать именно Xcode:
1. В терминале с помощью CMake сгенерируйте файл проекта для системы сборки `xcode`
   (см. подраздел [4.2 Использование CMake напрямую](#42-использование-cmake-напрямую)).
2. Откройте сгенерированный файл проекта в Xcode и работайте как обычно.
   - ⚠ Обратите внимание, что любые структурные изменения в проекте (добавление или удаление файлов)
   будут отображаться на сгенерированный файл проекта Xcode, но не на оригинальный `CMakeLists.txt`.
   Бремя поддержания `CMakeLists.txt` в актуальном состоянии ложится на плечи разработчика!



### 4.3.3 Windows

На Windows рекомендуется использовать Visual Studio, которая имеет встроенную поддержку `CMake`.

1. Запустите `Visual Studio`.
1. В стартовом окне справа в секции `Get started` нажмите на `Open a local folder`.
   В появившемся окне выберите директорию (но не заходите в неё),
   в которой находится файл `CMakeLists.txt` и нажмите на кнопку `Select folder`.
   - Если открыто не стартовое окно, а основное окно
     (например, в стартовом окне вы нажали на `Continue without code`), то выберите пункт меню
     `File` → `Open` → `CMake...` и в появившемся окне выберите подготовленный файл `CMakeLists.txt` и нажмите на `Open`.
1. Дождитесь, пока проект откроется.
   - Если всё сделанно верно, то во всплывающем меню под зелёной кнопкой запуска проекта
     (для появления меню нажмите на кнопку `▼`, находящуюся справа от зеленой кнопки
     сразу после текста `Select Startup Item...`) должен появиться пункт `lab1.exe`.
     Пункт может называться по-разному в зависимости от того, как вы назвали цель сборки в файле сценария.
     Выберите пункт, соответствующей вашей цели сборки и нажмите на зеленую стрелку.
     Проект должен скомпилироваться и запуститься.
   - Если соответствующего пункта нет или проект не компилируется/запускается, проанализируйте ошибки
     CMake и/или компилятора (см. вкладки `Error List` и `Output` в нижней части `Visual Sudio`).

Далее вы можете добавлять/редактировать/удалять файлы исходного кода и при необходимости редактировать файл сценария `CMakeLists.txt` прямо в среде разработки Visual Studio.
